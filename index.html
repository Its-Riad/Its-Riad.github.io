<!DOCTYPE html>
<html> 
<head>    
    <link rel="stylesheet" type="text/css" href="index.css">
    <title>My Portfolio</title>
    <!-- Vega libraries -->
    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
    <style>
        #chartGrid {
            display: flex;
        }
    </style>
</head>

<body> 
    <h1 class="big" style="margin-bottom: 0px;">Riad Ghoneim</h1>
    <p style="margin-top: 0px; color: darkblue">
        Riad Ghoneim | <a href="https://www.linkedin.com/in/riad-ghoneim/">LinkedIn</a> | <a href="https://www.github.com/its-riad">GitHub</a>
    </p>
    <h3 class="small">
        This page acts as your portfolio of charts. You can use it as a good starting point to display your work but make sure to customise it to make it your own, or even start from scratch.  
    </h3>

    <!-- Section 1: Existing chart -->
    <section>
        <div class="chart-description">
            <h2>Section 1: A basic chart</h2>
            <p>
                We've organised the page into sections, with each section containing a chart, title and a description. Here, we can describe the chart and give some context.
                As a first example, we're using a basic chart from our repo.
            </p>
        </div>
        <figure id="Location1"></figure>
    </section>

    <!-- Section 2: CO2 Vega-Lite chart -->
    <section>
        <div class="chart-description">
            <h2>Section 2: Decadal Line Chart of CO2 Concentration</h2>
            <p>
                This chart visualizes the atmospheric CO2 concentration by decade, showing year into decade on the x-axis.
            </p>
        </div>
        <figure id="co2_chart"></figure>
    </section>

    <!-- JavaScript for embedding charts -->
    <script>
        // Embed the first chart from your original spec
        let figure_1_spec = "https://raw.githubusercontent.com/EconomicsObservatory/courses/main/2/s2_chart2.json";
        vegaEmbed('#Location1', figure_1_spec);

        // Embed the new decadal CO2 concentration Vega-Lite chart
        const co2_spec = {
            "$schema": "https://vega.github.io/schema/vega-lite/v6.json",
            "data": {
                "url": "data/co2-concentration.csv",
                "format": {"parse": {"Date": "utc:'%Y-%m-%d'"}}
            },
            "width": 800,
            "height": 500,
            "transform": [
                {"calculate": "year(datum.Date)", "as": "year"},
                {"calculate": "floor(datum.year / 10)", "as": "decade"},
                {
                    "calculate": "(datum.year % 10) + (month(datum.Date)/12)",
                    "as": "scaled_date"
                },
                {
                    "calculate": "datum.first_date === datum.scaled_date ? 'first' : datum.last_date === datum.scaled_date ? 'last' : null",
                    "as": "end"
                }
            ],
            "encoding": {
                "x": {
                    "type": "quantitative",
                    "title": "Year into Decade",
                    "axis": {"tickCount": 11}
                },
                "y": {
                    "title": "CO2 concentration in ppm",
                    "type": "quantitative",
                    "scale": {"zero": false}
                },
                "color": {
                    "field": "decade",
                    "type": "ordinal",
                    "scale": {"scheme": "magma"},
                    "legend": null
                }
            },
            "layer": [
                {
                    "mark": "line",
                    "encoding": {
                        "x": {"field": "scaled_date"},
                        "y": {"field": "CO2"}
                    }
                },
                {
                    "mark": {"type": "text", "baseline": "top", "aria": false},
                    "encoding": {
                        "x": {"aggregate": "min", "field": "scaled_date"},
                        "y": {"aggregate": {"argmin": "scaled_date"}, "field": "CO2"},
                        "text": {"aggregate": {"argmin": "scaled_date"}, "field": "year"}
                    }
                },
                {
                    "mark": {"type": "text", "aria": false},
                    "encoding": {
                        "x": {"aggregate": "max", "field": "scaled_date"},
                        "y": {"aggregate": {"argmax": "scaled_date"}, "field": "CO2"},
                        "text": {"aggregate": {"argmax": "scaled_date"}, "field": "year"}
                    }
                }
            ],
            "config": {"text": {"align": "left", "dx": 3, "dy": 1}}
        };
        vegaEmbed('#co2_chart', co2_spec);
    </script>
</body>
</html>
