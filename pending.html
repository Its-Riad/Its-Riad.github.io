<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Income Inflation Visualization</title>
    
    <!-- Link to global styles -->
    <link rel="stylesheet" href="index.css">
    <!-- Link to visualizer-specific styles -->
    <link rel="stylesheet" href="vis_interactive.css">

    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@6"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
</head>
<body class="dark-theme">
    <!-- Navigation -->
    <nav>
        <div class="container">
            <a href="index.html" class="logo">It's Riad</a>
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="pending.html" class="active">Projects</a></li>
                <li><a href="portfolio_vis.html">Portfolio</a></li>
            </ul>
        </div>
    </nav>

    <!-- NORMAL VISUALISATION!!! NOOOOOOOOOOT THE METER -->
    <section style="display: flex; flex-direction: column; align-items: center; text-align: center;">
        <div class="chart-description">
            <h2>Section 1: A basic chart</h2>
            <p> <!-- This is a paragraph, it's the main way to display text on a web page -->
                We've organised the page into sections, with each section containing a chart, title and a description. Here, we can describe the chart and give some context.
                As a first example, we're using a basic chart from our repo.
            </p>
        </div>
        <figure id="Location1"></figure> <!-- we give it an id so we can put a vega-lite graph here with VegaEmbed -->
    </section>

      <section style="display: flex; flex-direction: column; align-items: center; text-align: center;">
        <div class="chart-description">
            <h2>Section 1: A basic chart</h2>
            <p> <!-- This is a paragraph, it's the main way to display text on a web page -->
                We've organised the page into sections, with each section containing a chart, title and a description. Here, we can describe the chart and give some context.
                As a first example, we're using a basic chart from our repo.
            </p>
        </div>
        <figure id="Location2"></figure>
    </section>
       <section style="display: flex; flex-direction: column; align-items: center; text-align: center;">
        <div class="chart-description">
            <h2>Section 1: A basic chart</h2>
            <p> <!-- This is a paragraph, it's the main way to display text on a web page -->
                We've organised the page into sections, with each section containing a chart, title and a description. Here, we can describe the chart and give some context.
                As a first example, we're using a basic chart from our repo.
            </p>
        </div>
        <figure id="Location3"></figure>
    </section>

        <!-- ============================================
             TAXI METER SECTION
             ============================================ -->
        <div class="meter-section">
            <h3>Purchasing Power</h3>
            <div class="meter-wrapper">
                <div class="meter-container">
                    <img src="taxi_meter_1.png" alt="Taxi Meter Base" class="meter-base">
                    <div class="meter-digits" id="meterDigits"></div>
                </div>
                <div class="arabic-text-container">
                    <img src="arabic_text.png" alt="Arabic Text" class="arabic-text-img">
                </div>
            </div>
        </div>

        <!-- ============================================
             MAIN CONTENT GRID
             ============================================ -->
        <div class="vis-grid">
            
            <!-- LEFT COLUMN: VISUALIZATIONS -->
            <div class="vis-area">
                
                <!-- CIRCLE VIEW -->
                <div id="circlesView" class="viz-view">
                    <div class="circle-container">
                        <svg width="500" height="500" viewBox="0 0 500 500">
                            <circle id="nominalCircle" cx="250" cy="250" r="200" fill="#ffffff" opacity="1" />
                            <circle id="nominalCircleStroke" cx="250" cy="250" r="200" fill="none" stroke="#ffffff" stroke-width="2" />
                            <circle id="inflationRing" cx="250" cy="250" r="160" fill="none" stroke="#ef4444" stroke-width="3" stroke-dasharray="10,5" opacity="0.7" />
                            <text id="inflationText" x="250" y="70" text-anchor="middle" class="svg-text" style="fill: #ef4444; font-size: 14px;">
                                Egypt Current: <tspan id="actualInflationSVG">12.3</tspan>%
                            </text>
                            <circle id="realCircle" cx="250" cy="250" r="160" fill="#3b82f6" opacity="0.5" />
                            <circle id="realCircleStroke" cx="250" cy="250" r="160" fill="none" stroke="#1e40af" stroke-width="2" />
                            <text x="250" y="240" text-anchor="middle" class="svg-text" style="fill: #1e40af; font-size: 18px;">Real Income</text>
                            <text id="realIncomeTextSVG" x="250" y="265" text-anchor="middle" class="svg-text" style="fill: #1e40af; font-size: 24px;">
                                0 EGP
                            </text>
                        </svg>
                        
                        <!-- Legend -->
                        <div class="legend">
                            <div class="legend-item">
                                <div class="legend-box legend-nominal"></div>
                                <span>Nominal Income</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-box legend-inflation"></div>
                                <span>Egypt Inflation</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-box legend-real"></div>
                                <span>Real Income</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- BAR CHART VIEW -->
                <div id="barsView" class="viz-view" style="display: none;">
                    <h2>Income Breakdown</h2>
                    <div class="bars-container">
                        <!-- Bar 1: User's scenario -->
                        <div class="bar-row">
                            <div class="bar-header">
                                <span class="bar-label">Your Scenario (<span id="inflationRateBar1">25</span>% inflation)</span>
                                <span class="bar-value"><span id="nominalIncomeBar1">50,000</span> EGP</span>
                            </div>
                            <div class="bar-visual" id="bar1Container">
                                <div class="bar-segment bar-real" style="width: 80%" id="bar1Real">
                                    <span id="bar1RealText">Real: 40,000 EGP</span>
                                </div>

                                <div class="bar-segment bar-loss" style="width: 20%" id="bar1Loss">
                                    <span id="bar1LossText">Loss: 10,000 EGP</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Bar 2: Egypt current -->
                        <div class="bar-row">
                            <div class="bar-header">
                                <span class="bar-label">Egypt Current (<span id="actualInflationBar">12.3</span>% inflation)</span>
                                <span class="bar-value"><span id="nominalIncomeBar2">50,000</span> EGP</span>
                            </div>
                            <div class="bar-visual bar-visual-egypt" id="bar2Container">
                                <div class="bar-segment bar-real" style="width: 89%" id="bar2Real">
                                    <span id="bar2RealText">Real: 44,500 EGP</span>
                                </div>
                                <div class="bar-segment bar-loss" style="width: 11%" id="bar2Loss">
                                    <span id="bar2LossText">Loss: 5,500 EGP</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- RIGHT COLUMN: CONTROLS -->
            <div class="controls-area">
                <!-- View Toggle Buttons -->
                <div class="view-buttons">
                    <button onclick="setViewMode('circles')" id="btnCircles" class="view-btn active">
                        Circle View
                    </button>
                    <button onclick="setViewMode('bars')" id="btnBars" class="view-btn">
                        Bar Chart View
                    </button>
                </div>
                
                <!-- Sliders -->
                <div class="sliders">
                    <!-- Income Slider -->
                    <div class="slider-wrapper">
                        <label class="slider-label">Nominal Income</label>
                        <div class="slider-value" id="incomeValue">50,000</div>
                        <input
                            type="range"
                            orient="vertical"
                            min="10000"
                            max="50000"
                            step="5000"
                            value="50000"
                            id="incomeSlider"
                            class="slider-vertical"
                        />
                        <div class="slider-unit">EGP</div>
                    </div>
                    
                    <!-- Inflation Slider -->
                    <div class="slider-wrapper">
                        <label class="slider-label">Inflation</label>
                        <div class="slider-value" id="inflationValue">25</div>
                        <input
                            type="range"
                            orient="vertical"
                            min="0"
                            max="50"
                            step="1"
                            value="25"
                            id="inflationSlider"
                            class="slider-vertical"
                        />
                        <div class="slider-unit">Egypt: <span id="actualInflation">12.3</span>%</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
       <section style="display: flex; flex-direction: column; align-items: center; text-align: center;">
        <div class="chart-description">
            <h2>Section 1: A basic chart</h2>
            <p> <!-- This is a paragraph, it's the main way to display text on a web page -->
                We've organised the page into sections, with each section containing a chart, title and a description. Here, we can describe the chart and give some context.
                As a first example, we're using a basic chart from our repo.
            </p>
        </div>
        <figure id="Location4"></figure>
    </section>
      <section style="display: flex; flex-direction: column; align-items: center; text-align: center;">
        <div class="chart-description">
            <h2>Section 1: A basic chart</h2>
            <p> <!-- This is a paragraph, it's the main way to display text on a web page -->
                We've organised the page into sections, with each section containing a chart, title and a description. Here, we can describe the chart and give some context.
                As a first example, we're using a basic chart from our repo.
            </p>
        </div>
        <figure id="Location5"></figure>
    </section>
      </section>
      <section style="display: flex; flex-direction: column; align-items: center; text-align: center;">
        <div class="chart-description">
            <h2>Section 1: A basic chart</h2>
            <p> <!-- This is a paragraph, it's the main way to display text on a web page -->
                We've organised the page into sections, with each section containing a chart, title and a description. Here, we can describe the chart and give some context.
                As a first example, we're using a basic chart from our repo.
            </p>
        </div>
        <figure id="Location6"></figure>
    </section>

    <!-- Footer -->
    <footer>
        <p>Â© 2025 Riad Ghoneim</p>
    </footer>

    <script>
        // ============================================
        // STATE VARIABLES
        // ============================================
        let figure_1_spec = "vis_inf_mar_egy_alg.json";
        let figure_2_spec = "vis_fx_egy.json";
        let figure_3_spec = "vis_dev_egy.json";
        let figure_4_spec = "vis_cci_egy.json";
        let figure_5_spec = "vis_media_egy.json";
        let figure_6_spec = "vis_forecast_inf_egy.json";

        let nominalIncome = 50000;
        let inflationRate = 25;
        let actualInflation = 12.3;
        let viewMode = 'circles';
        let currentFrame = 0;
        let animationInterval = null;
        const frames = [
            'meter_horse_1.png',
            'meter_horse_2.png',
            'meter_horse_3.png',
            'meter_horse_4.png'
        ];

        // ============================================
        // TAXI METER FUNCTIONS
        // ============================================
        function updateMeter(value) {
            const valueStr = String(value).padStart(5, '0');
            const firstNonZero = valueStr.search(/[1-9]/);
            const meterDiv = document.getElementById('meterDigits');
            
            meterDiv.innerHTML = '';
            
            for (let i = 0; i < 5; i++) {
                const digit = valueStr[i];
                const img = document.createElement('img');
                
                if (digit === '0' && (firstNonZero === -1 || i < firstNonZero)) {
                    img.src = 'meter(null).png';
                } else {
                    img.src = 'meter(' + digit + ').png';
                }
                
                img.alt = digit;
                meterDiv.appendChild(img);
            }
            
            updateMeterAnimation(value);
        }

        function updateMeterAnimation(itemsCanBuy) {
            if (animationInterval) {
                clearInterval(animationInterval);
            }
            
            const maxSpeed = 30;
            const minSpeed = 400;
            const speedRange = minSpeed - maxSpeed;
            const normalizedItems = Math.min(itemsCanBuy, 5000);
            const speedFactor = normalizedItems / 5000;
            const frameDelay = minSpeed - (speedRange * speedFactor);
            
            animationInterval = setInterval(() => {
                currentFrame = (currentFrame + 1) % frames.length;
                const baseImg = document.querySelector('.meter-base');
                if (baseImg) {
                    baseImg.src = frames[currentFrame];
                }
            }, frameDelay);
        }

        // ============================================
        // CALCULATION FUNCTIONS
        // ============================================
        function updateCalculations() {
            const realIncome = nominalIncome / (1 + inflationRate / 100);
            const itemsCanBuy = Math.floor(realIncome / 10);
            
            document.getElementById('incomeValue').textContent = nominalIncome.toLocaleString();
            document.getElementById('inflationValue').textContent = inflationRate;
            
            updateMeter(itemsCanBuy);
            renderVisualization();
        }


        // ============================================
        // VISUALIZATION RENDERING
        // ============================================
        function renderVisualization() {
            const realIncome = nominalIncome / (1 + inflationRate / 100);
            const maxRadius = 230;
            const nominalRadius = Math.min((nominalIncome / 50000) * 150 + 100, maxRadius);
            const realRadius = nominalRadius / (1 + inflationRate / 100);
            const inflationRingRadius = nominalRadius / (1 + actualInflation / 100);
            
            if (viewMode === 'circles') {
                renderCircleView(nominalRadius, realRadius, inflationRingRadius, realIncome);
            } else {
                renderBarView(realIncome);
            }
        }

        function renderCircleView(nominalRadius, realRadius, inflationRingRadius, realIncome) {
            document.getElementById('nominalCircle').setAttribute('r', nominalRadius);
            document.getElementById('nominalCircleStroke').setAttribute('r', nominalRadius);
            document.getElementById('realCircle').setAttribute('r', realRadius);
            document.getElementById('realCircleStroke').setAttribute('r', realRadius);
            document.getElementById('inflationRing').setAttribute('r', inflationRingRadius);
            document.getElementById('inflationText').setAttribute('y', 250 - inflationRingRadius - 15);
            document.getElementById('actualInflationSVG').textContent = actualInflation.toFixed(1);
            document.getElementById('realIncomeTextSVG').textContent = Math.floor(realIncome).toLocaleString() + ' EGP';
        }

        function renderBarView(realIncome) {
            const barHeight = Math.max(60, (nominalIncome / 50000) * 200);
            document.getElementById('bar1Container').style.height = barHeight + 'px';
            document.getElementById('bar2Container').style.height = barHeight + 'px';
            
            const realPercent = (realIncome / nominalIncome) * 100;
            const lossPercent = 100 - realPercent;
            
            document.getElementById('inflationRateBar1').textContent = inflationRate;
            document.getElementById('nominalIncomeBar1').textContent = nominalIncome.toLocaleString();
            document.getElementById('nominalIncomeBar2').textContent = nominalIncome.toLocaleString();
            document.getElementById('actualInflationBar').textContent = actualInflation.toFixed(1);
            
            document.getElementById('bar1Real').style.width = realPercent + '%';
            document.getElementById('bar1Loss').style.width = lossPercent + '%';
            document.getElementById('bar1RealText').textContent = 'Real: ' + Math.floor(realIncome).toLocaleString() + ' EGP';
            document.getElementById('bar1LossText').textContent = 'Loss: ' + Math.floor(nominalIncome - realIncome).toLocaleString() + ' EGP';
            
            const egyptRealIncome = nominalIncome / (1 + actualInflation / 100);
            const egyptRealPercent = (egyptRealIncome / nominalIncome) * 100;
            const egyptLossPercent = 100 - egyptRealPercent;
            
            document.getElementById('bar2Real').style.width = egyptRealPercent + '%';
            document.getElementById('bar2Loss').style.width = egyptLossPercent + '%';
            document.getElementById('bar2RealText').textContent = 'Real: ' + Math.floor(egyptRealIncome).toLocaleString() + ' EGP';
            document.getElementById('bar2LossText').textContent = 'Loss: ' + Math.floor(nominalIncome - egyptRealIncome).toLocaleString() + ' EGP';
        }

        // ============================================
        // VIEW MODE SWITCHING
        // ============================================
        function setViewMode(mode) {
            viewMode = mode;
            const btnCircles = document.getElementById('btnCircles');
            const btnBars = document.getElementById('btnBars');
            const circlesView = document.getElementById('circlesView');
            const barsView = document.getElementById('barsView');
            
            if (mode === 'circles') {
                btnCircles.classList.add('active');
                btnBars.classList.remove('active');
                circlesView.style.display = 'block';
                barsView.style.display = 'none';
            } else {
                btnBars.classList.add('active');
                btnCircles.classList.remove('active');
                circlesView.style.display = 'none';
                barsView.style.display = 'block';
            }
            
            renderVisualization();
        }

        // ============================================
        // EVENT LISTENERS
        // ============================================
        document.getElementById('incomeSlider').addEventListener('input', function(e) {
            nominalIncome = Number(e.target.value);
            updateCalculations();
        });

        document.getElementById('inflationSlider').addEventListener('input', function(e) {
            inflationRate = Number(e.target.value);
            updateCalculations();
        });

        // ============================================
        // EXTERNAL DATA FETCHING
        // ============================================
        fetch('https://api.worldbank.org/v2/country/EGY/indicator/FP.CPI.TOTL.ZG?format=json&date=2024:2025&per_page=1')
            .then(r => r.json())
            .then(data => {
                if (data[1] && data[1][0] && data[1][0].value) {
                    actualInflation = parseFloat(data[1][0].value);
                    document.getElementById('actualInflation').textContent = actualInflation.toFixed(1);
                    updateCalculations();
                }
            })
            .catch(() => {});

        // ============================================
        // INITIALIZATION
        // ============================================
        updateCalculations();

        vegaEmbed('#Location1', figure_1_spec, {
    "actions": false,
    "config": {
        "background": null
    }
});

        vegaEmbed('#Location2', figure_2_spec, {
    "actions": false,
    "config": {
        "background": null
    }
});

         vegaEmbed('#Location3', figure_3_spec, {
    "actions": false,
    "config": {
        "background": null
    }
});
        vegaEmbed('#Location4', figure_4_spec, {
    "actions": false,
    "config": {
        "background": null
    }
});
        vegaEmbed('#Location5', figure_5_spec, {
    "actions": false,
    "config": {
        "background": null
    }
});
        vegaEmbed('#Location6', figure_6_spec, {
    "actions": false,
    "config": {
        "background": null
    }
});

    </script>
</body>
</html>