{
  "$schema": "https://vega.github.io/schema/vega-lite/v6.json",
  "title": {
    "text": "Net Sentiment: Positive vs Negative Articles",
    "subtitle": "Daily balance with 7-day moving average. Source: Scraped Egyptian news outlets",
    "color": "white",
    "subtitleColor": "white",
    "fontSize": 20
  },
  "config": {
    "background": null,
    "view": {"stroke": null},
    "axis": {
      "labelColor": "white",
      "titleColor": "white",
      "labelFontSize": 14,
      "titleFontSize": 16,
      "gridColor": "#444",
      "domainColor": "white"
    },
    "legend": {
      "labelColor": "white",
      "titleColor": "white",
      "labelFontSize": 14
    }
  },
  "hconcat": [
    {
      "width": 400,
      "height": 400,
      "title": {
        "text": "English News",
        "color": "#60a5fa",
        "fontSize": 16
      },
      "data": {
        "url": "https://raw.githubusercontent.com/Its-Riad/Its-Riad.github.io/main/data/english_news.csv"
      },
      "transform": [
        {"filter": "datum.sentiment_label != 'error'"},
        {"filter": "datum.sentiment_label != 'neutral'"},
        {
          "calculate": "datum.sentiment_label == 'positive' ? 1 : -1",
          "as": "sentiment_direction"
        },
        {
          "aggregate": [{"op": "sum", "field": "sentiment_direction", "as": "net_sentiment"}],
          "groupby": ["date_published"]
        },
        {
          "window": [{"op": "mean", "field": "net_sentiment", "as": "moving_avg"}],
          "sort": [{"field": "date_published"}],
          "frame": [-3, 3]
        }
      ],
      "layer": [
        {
          "mark": "bar",
          "encoding": {
            "x": {
              "field": "date_published",
              "type": "temporal",
              "title": "Date",
              "axis": {
                "domain": false,
                "ticks": false,
                "labelAngle": -45
              }
            },
            "y": {
              "field": "net_sentiment",
              "type": "quantitative",
              "title": "Net Sentiment",
              "axis": {
                "gridColor": {
                  "condition": {"test": "datum.value === 0", "value": "white"},
                  "value": "#444"
                }
              }
            },
            "color": {
              "condition": {
                "test": "datum.net_sentiment > 0",
                "value": "#10b981"
              },
              "value": "#ef4444"
            },
            "tooltip": [
              {"field": "date_published", "type": "temporal", "title": "Date"},
              {"field": "net_sentiment", "type": "quantitative", "title": "Net"}
            ]
          }
        },
        {
          "mark": {
            "type": "line",
            "strokeWidth": 3,
            "color": "#60a5fa"
          },
          "encoding": {
            "x": {"field": "date_published", "type": "temporal"},
            "y": {"field": "moving_avg", "type": "quantitative"}
          }
        }
      ]
    },
    {
      "width": 400,
      "height": 400,
      "title": {
        "text": "Arabic News",
        "color": "#60a5fa",
        "fontSize": 16
      },
      "data": {
        "url": "https://raw.githubusercontent.com/Its-Riad/Its-Riad.github.io/main/data/arabic_news.csv"
      },
      "transform": [
        {"filter": "datum.sentiment_label != 'neutral'"},
        {
          "calculate": "datum.sentiment_label == 'positive' ? 1 : -1",
          "as": "sentiment_direction"
        },
        {
          "aggregate": [{"op": "sum", "field": "sentiment_direction", "as": "net_sentiment"}],
          "groupby": ["date_published"]
        },
        {
          "window": [{"op": "mean", "field": "net_sentiment", "as": "moving_avg"}],
          "sort": [{"field": "date_published"}],
          "frame": [-3, 3]
        }
      ],
      "layer": [
        {
          "mark": "bar",
          "encoding": {
            "x": {
              "field": "date_published",
              "type": "temporal",
              "title": "Date",
              "axis": {
                "domain": false,
                "ticks": false,
                "labelAngle": -45
              }
            },
            "y": {
              "field": "net_sentiment",
              "type": "quantitative",
              "title": "Net Sentiment",
              "axis": {
                "gridColor": {
                  "condition": {"test": "datum.value === 0", "value": "white"},
                  "value": "#444"
                }
              }
            },
            "color": {
              "condition": {
                "test": "datum.net_sentiment > 0",
                "value": "#10b981"
              },
              "value": "#ef4444"
            },
            "tooltip": [
              {"field": "date_published", "type": "temporal", "title": "Date"},
              {"field": "net_sentiment", "type": "quantitative", "title": "Net"}
            ]
          }
        },
        {
          "mark": {
            "type": "line",
            "strokeWidth": 3,
            "color": "#60a5fa"
          },
          "encoding": {
            "x": {"field": "date_published", "type": "temporal"},
            "y": {"field": "moving_avg", "type": "quantitative"}
          }
        }
      ]
    }
  ]
}